postgres=# CREATE TABLE Artist (
       artID SERIAL NOT NULL,
       artName VARCHAR(255) NOT NULL,
       CONSTRAINT pk_artist PRIMARY KEY (artID),
       CONSTRAINT ck_artist UNIQUE (artName)
);
CREATE TABLE
postgres=# CREATE TABLE CD (
       cdID SERIAL NOT NULL,
       artID INT NOT NULL,
       cdTitle VARCHAR(255) NOT NULL,
       cdPrice REAL NOT NULL,
       cdGenre VARCHAR(255) NULL,
        cdNumTracks INT NULL,
       CONSTRAINT pk_cd PRIMARY KEY (cdID),
       CONSTRAINT fk_cd_art FOREIGN KEY (artID) REFERENCES Artist (artID)
);
CREATE TABLE
postgres=#
INSERT INTO Artist (artName)
VALUES  ('Muse'),
                ('Mr. Scruff'),
                ('DeadMau5'),
                ('Mark Ronson'),
                ('Mark Ronson & The Business Intl'),
        ('Animal Collective'),
                ('Kings of Leon'),
                ('Maroon 5');
INSERT 0 8

ex1 
postgres=# select cdTitle, cdPrice From CD
where cdTitle not like '% %' ;
 cdtitle | cdprice 
---------+---------
 Version |   12.99
(1 row)
 
ex2 
SELECT cdTitle, artName
FROM CD
JOIN Artist ON CD.artID = Artist.artID
WHERE cdTitle LIKE '%ro%';
       cdtitle       |    artname    
---------------------+---------------
 Come Around Sundown | Kings of Leon
(1 row)

ex3 
\dt select * 
from CD 
where cdTitle like '_he%' 
 ;
 cdid | artid |    cdtitle     | cdprice | cdgenre | cdnumtracks 
------+-------+----------------+---------+---------+-------------
    2 |     1 | The Resistance |   11.99 | Rock    |
(1 row)

ex4 
SELECT cdTitle
FROM CD
WHERE cdGenre = (SELECT cdGenre FROM CD WHERE cdTitle = 'Version');
    cdtitle     
----------------
 Version
 Hands All Over
(2 rows)

ex5 
SELECT cdTitle
FROM CD
WHERE cdPrice IN (SELECT cdPrice FROM CD WHERE cdGenre = 'Electronica');
-----------------------------
 Black Holes and Revelations
 Ninja Tuna
 For Lack of a Better Name
 Version
 Merriweather Post Pavilion
 Only By The Night
 Come Around Sundown
(7 rows)

ex6 
 SELECT cdTitle
FROM CD
WHERE cdPrice < ANY (SELECT cdPrice FROM CD);
           cdtitle
-----------------------------
 Black Holes and Revelations
 The Resistance
 Ninja Tuna
 For Lack of a Better Name
 Record Collection
 Only By The Night
 Hands All Over
(7 rows)

ex7
SELECT cdTitle
FROM CD
WHERE cdPrice = ALL (SELECT MIN(cdPrice) FROM CD);
           cdtitle
-----------------------------
 Black Holes and Revelations
 Ninja Tuna
 For Lack of a Better Name
 Only By The Night
(4 rows)

ex8
SELECT DISTINCT artName
FROM Artist
WHERE EXISTS (SELECT 1 FROM CD WHERE Artist.artID = CD.artID AND cdGenre = 'Pop');
   artname   
-------------
 Mark Ronson
 Maroon 5
(2 rows)

ex9 
SELECT DISTINCT artName
FROM Artist
JOIN CD ON Artist.artID = CD.artID
WHERE cdGenre = 'Rock';
    artname    
---------------
 Kings of Leon
 Muse
(2 rows)

ex10 
SELECT cdTitle
FROM CD
WHERE artID IN (SELECT artID FROM Artist WHERE artName LIKE '% %');
          cdtitle
----------------------------
 Ninja Tuna
 Version
 Record Collection
 Merriweather Post Pavilion
 Come Around Sundown
 Only By The Night
 Hands All Over
(7 rows)

ex11 
SELECT *
FROM CD
WHERE (cdGenre = 'Rock' OR cdGenre = 'Pop') AND cdPrice < ALL (SELECT cdPrice FROM CD WHERE cdGenre = 'Rock' OR cdGenre = 'Pop');

ex12 
SELECT artName, artID
FROM Artist
WHERE artID IN (SELECT artID FROM CD WHERE cdPrice = 12.99);
 artname | artid 
---------+-------
(0 rows)

ex13 
SELECT cdTitle
FROM CD
ORDER BY cdTitle DESC;
           cdtitle
-----------------------------
 Version
 The Resistance
 Record Collection
 Only By The Night
 Ninja Tuna
 Merriweather Post Pavilion
 Hands All Over
 For Lack of a Better Name
 Come Around Sundown
 Black Holes and Revelations
(10 rows)

ex14 
SELECT cdTitle, cdGenre, cdPrice
FROM CD
ORDER BY cdPrice ASC;
           cdtitle           |     cdgenre      | cdprice 
-----------------------------+------------------+---------
 Black Holes and Revelations | Rock             |    9.99
 Ninja Tuna                  | Electronica      |    9.99
 Only By The Night           | Rock             |    9.99
 For Lack of a Better Name   | Electro House    |    9.99
 Hands All Over              | Pop              |   11.99
 The Resistance              | Rock             |   11.99
 Record Collection           | Alternative Rock |   11.99
 Merriweather Post Pavilion  | Electronica      |   12.99
 Come Around Sundown         | Rock             |   12.99
 Version                     | Pop              |   12.99
(10 rows)

ex15 
SELECT cdTitle, cdGenre, cdPrice
FROM CD
ORDER BY cdPrice DESC;
           cdtitle           |     cdgenre      | cdprice 
-----------------------------+------------------+---------
 Merriweather Post Pavilion  | Electronica      |   12.99
 Version                     | Pop              |   12.99
 Come Around Sundown         | Rock             |   12.99
 Hands All Over              | Pop              |   11.99
 The Resistance              | Rock             |   11.99
 Record Collection           | Alternative Rock |   11.99
 For Lack of a Better Name   | Electro House    |    9.99
 Only By The Night           | Rock             |    9.99
 Ninja Tuna                  | Electronica      |    9.99
 Black Holes and Revelations | Rock             |    9.99

 ex16
 SELECT cdTitle, cdGenre, cdPrice
FROM CD
ORDER BY cdGenre ASC, cdPrice DESC;
           cdtitle           |     cdgenre      | cdprice 
-----------------------------+------------------+---------
 Record Collection           | Alternative Rock |   11.99
 For Lack of a Better Name   | Electro House    |    9.99
 Merriweather Post Pavilion  | Electronica      |   12.99
 Ninja Tuna                  | Electronica      |    9.99
 Version                     | Pop              |   12.99
 Hands All Over              | Pop              |   11.99
 Come Around Sundown         | Rock             |   12.99
 The Resistance              | Rock             |   11.99
 Only By The Night           | Rock             |    9.99
 Black Holes and Revelations | Rock             |    9.99
(10 rows)

ex17 
SELECT artName, COUNT(cdID) AS numCDs, AVG(cdPrice) AS avgPrice
FROM Artist
JOIN CD ON Artist.artID = CD.artID
GROUP BY artName
HAVING COUNT(cdID) > 1;
    artname    | numcds |      avgprice      
---------------+--------+--------------------
 Kings of Leon |      2 | 11.489999771118164
 Muse          |      2 | 10.989999771118164
(2 rows)

ex18
SELECT artName, COUNT(cdID) AS numCDs, AVG(cdPrice) AS avgPrice
FROM Artist
JOIN CD ON Artist.artID = CD.artID
WHERE cdGenre != 'Electronica'
GROUP BY artName;
             artname             | numcds |      avgprice      
---------------------------------+--------+--------------------
 Kings of Leon                   |      2 | 11.489999771118164
 Mark Ronson & The Business Intl |      1 | 11.989999771118164
 Mark Ronson                     |      1 | 12.989999771118164
 Muse                            |      2 | 10.989999771118164
 DeadMau5                        |      1 |  9.989999771118164
 Maroon 5                        |      1 | 11.989999771118164
(6 rows)

ex19
SELECT ABS(AVG(CASE WHEN cdGenre = 'Rock' THEN cdPrice ELSE NULL END) - 
           AVG(CASE WHEN artName != 'Muse' THEN cdPrice ELSE NULL END)) AS priceDifference
FROM CD
JOIN Artist ON CD.artID = Artist.artID;
 pricedifference 
-----------------
           0.375
(1 row)

ex20 
SELECT artName
FROM Artist
JOIN CD ON Artist.artID = CD.artID
GROUP BY artName
HAVING AVG(cdPrice) = (SELECT MAX(avgPrice) FROM (SELECT AVG(cdPrice) AS avgPrice FROM CD GROUP BY artID) AS avgPrices);
      artname      
-------------------
 Animal Collective
 Mark Ronson
(2 rows)

ex21 
 SELECT cdGenre
FROM CD
GROUP BY cdGenre
HAVING AVG(cdPrice) = (SELECT MAX(avgPrice) FROM (SELECT AVG(cdPrice) AS avgPrice FROM CD GROUP BY cdGenre) AS avgPrices);
 cdgenre 
---------
 Pop
(1 row)

ex22 
SELECT artName, COUNT(cdID) AS numCDs, AVG(cdPrice) AS avgPrice
FROM Artist
JOIN CD ON Artist.artID = CD.artID
WHERE cdGenre != 'Pop'
GROUP BY artName;
             artname             | numcds |      avgprice      
---------------------------------+--------+--------------------
 Kings of Leon                   |      2 | 11.489999771118164
 Mr. Scruff                      |      1 |  9.989999771118164
 Mark Ronson & The Business Intl |      1 | 11.989999771118164
 Animal Collective               |      1 | 12.989999771118164
 Muse                            |      2 | 10.989999771118164
 DeadMau5                        |      1 |  9.989999771118164
(6 rows)